<!DOCTYPE html>
<html>
<head>
    <title>检查 localStorage 中的对话历史</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>检查 localStorage 中的对话历史</h1>
    <div id="output"></div>
    <script>
        const output = document.getElementById('output');
        const today = new Date().toISOString().split('T')[0];
        const keys = Object.keys(localStorage);
        
        let html = '<h2>所有 localStorage 键：</h2><ul>';
        keys.forEach(key => {
            html += `<li><strong>${key}</strong>: ${localStorage.getItem(key).substring(0, 100)}...</li>`;
        });
        html += '</ul>';
        
        html += `<h2>今天的对话历史键（conversation_${today}）：</h2>`;
        const todayKey = `conversation_${today}`;
        const todayData = localStorage.getItem(todayKey);
        if (todayData) {
            html += `<pre>${JSON.stringify(JSON.parse(todayData), null, 2)}</pre>`;
        } else {
            html += '<p>没有找到今天的对话历史</p>';
        }
        
        html += '<h2>所有对话历史键：</h2><ul>';
        keys.filter(k => k.startsWith('conversation_')).forEach(key => {
            const data = localStorage.getItem(key);
            try {
                const parsed = JSON.parse(data);
                html += `<li><strong>${key}</strong>: ${parsed.conversation.length} 条对话消息</li>`;
            } catch(e) {
                html += `<li><strong>${key}</strong>: 解析失败</li>`;
            }
        });
        html += '</ul>';
        
        output.innerHTML = html;
    </script>
</body>
</html>
